<!DOCTYPE html>
<HTML>

<HEAD>
   <TITLE>Energy Converter</TITLE>

   <SCRIPT LANGUAGE="JavaScript">


      const iBoltz = 8;
      const inm = 9;

      //DEFINE METHODS
      function constants(conv) {
         // [unit] / Hartree
         var numE = 9;
         // Eh
         conv[0] = 1.000;
         // eV
         conv[1] = 2.7211399E+01; // [ev / Eh]
         // kJ/mol
         conv[2] = 2.6255002E+03; // [kJ/mol / Eh]
         // kcal/mol
         conv[3] = conv[2] / 4.184; // [kcal/mol / Eh]
         // cm-1
         conv[4] = 2.1947463E+05; // [cm-1 / Eh]
         // nm
         conv[5] = conv[1] / 4.135667696e-15 * 1e-9; // [GHz / Eh]
         // V
         conv[6] = 2.6255002E+06 / 96484.6; // [V (e-) / Eh]
         // K
         conv[7] = 3.1577709E+05; // [K / Eh]
         // Boltzman
         conv[iBoltz] = -conv[7]; // [K / Eh]
         // nm
         conv[inm] = 45.563352519; // [nm Eh]
         return numE;
      }

      function displayInfo(form, field) {
         var btemp = Number.parseFloat(document.Boltzman.T.value);

         // find field index
         for (var i = 0; i <= nfields; i++) {
            if (form.elements[i].name == field) {
               idx = i;
               break;
            }
         }

         // check form input
         inval = form.elements[idx].value.replace(",","");
         if (Number.parseFloat(inval) < 0) {
            inval = -inval;
            form.elements[idx].value = form.elements[idx].value.replace("-","");
         }

         // find number of characters in input string for significant figure functions
         nchars = form.elements[idx].value.length + 1;

         // calculate the base energy in Hartrees
         // if (idx < 7) {
            energy = inval / conv[idx];
         // } else
         if (idx == iBoltz) {
            boltztemp = form.elements.
            energy = Math.log(inval) * btemp / conv[idx];
         } else if (idx == inm) {
            energy = conv[idx] / inval;
         }

         // convert to other units
         for (var i = 0; i <= nfields; i++) {
            var ceng = 0;
            if (i != idx) {
               // if (i < 7) {
                  ceng = trunc(energy * conv[i], nchars);
               // } else 
               if (i == iBoltz) {
                  ceng = trunc(Math.exp(energy * conv[i] / btemp), 4);
               } else if (i == inm) {
                  ceng = trunc(conv[i] / energy, nchars);
               }
               if (ceng >= 10000) {
                  ceng = ceng.toLocaleString();
               }
               form.elements[i].value = ceng
            }
         }
         boltzman()
      }

      function updateTemp() {
         var T = document.Boltzman.T.value;
         document.getElementById("btemp").innerText = T;
         boltzman();
         displayInfo(document.Hartree, "K");
      }      

      function boltzman() {
         // calculate boltzman fractions and voltage for general conditions
         var T = document.Boltzman.T.value;
         var gj = document.Boltzman.gj.value;
         var gi = document.Boltzman.gi.value;
         var z = document.Boltzman.z.value;
         var r = Math.exp(energy * conv[7] / T) * gj / gi;
         document.Boltzman.flow.value = trunc(1 / (r + 1) * 100.0, 3);
         var fup = trunc(r / (r + 1) * 100.0, 3);
         if (fup > 1e-20) {
            document.Boltzman.fup.value = fup
         } else {
            document.Boltzman.fup.value = 0
         }
         // Put in diagram poulations
         var all = "-oooooooooo";
         var molecules = Math.floor(r / (r + 1) * 10.0 + 0.5);
         document.Boltzman.up.value = all.substring(0, molecules + 1) + "-";
         document.Boltzman.low.value = all.substring(0, 11 - molecules) + "-";
         // Voltage for z != 1
         document.Boltzman.V.value = trunc(energy * conv[5] / z, nchars);
      }

      // Significant figure functions
      function ord(x) {
         return Math.floor(Math.log(Math.abs(x + 1e-35)) / 2.303)
      }
      // Truncate to n sign. figures
      function trunc(x, n) {
         return Math.floor(x * Math.pow(10, -ord(x) + n - 1) + .5) / Math.pow(10, -ord(x) + n - 1)
      }

      // MAIN variable declarations
      var energy = 0.000;
      var nchars = 0;
      var conv = new Array();
      var nfields = constants(conv);

   </SCRIPT>
</HEAD>

<BODY onload="document.getElementById('eVinput').focus()">
   <H3>Energy Units Converter</H3>
   <H4>Adapted from the <a href="https://www.colby.edu/chemistry/PChem/Hartree.html">energy
         units converter by Colby pchem</a> to add wavelength.</H4>
   <P>
   <FORM NAME="Hartree" METHOD=POST>

      <INPUT TYPE="text" NAME="H" VALUE=0 oninput="displayInfo(this.form,this.name);">Hartrees<BR>
      <INPUT TYPE="text" ID="eVinput" NAME="eV" VALUE=0 oninput="displayInfo(this.form,this.name);">eV<BR>
      <INPUT TYPE="text" NAME="kJ/mol" VALUE=0 oninput="displayInfo(this.form,this.name);">kJ/mol<BR>
      <INPUT TYPE="text" NAME="kcal/mol" VALUE=0 oninput="displayInfo(this.form,this.name);">kcal/mol<BR>
      <INPUT TYPE="text" NAME="cm-1" VALUE=0 oninput="displayInfo(this.form,this.name);">cm<sup>-1</sup><BR>
      <INPUT TYPE="text" NAME="GHz" VALUE=0 oninput="displayInfo(this.form,this.name);">GHz<BR>
      <INPUT TYPE="text" NAME="V" VALUE=0 oninput="displayInfo(this.form,this.name);">V for 1e<sup>-</sup> transfer<BR>
      <INPUT TYPE="text" NAME="K" VALUE=0 oninput="displayInfo(this.form,this.name);">K (equivalent temerature)<BR>
      <INPUT TYPE="text" NAME="B" VALUE=1 oninput="displayInfo(this.form,this.name);">Boltzman population ratio at <b id="btemp">298.15</b> K<BR>
      <INPUT TYPE="text" NAME="nm" VALUE=1 oninput="displayInfo(this.form,this.name);">nm

   </FORM>
   <HR>
   <H5>Boltzman Populations</H5>
   Change the temperature and degeneracies:
   <FORM NAME="Boltzman" METHOD=POST>
      <TABLE>
         <TR>
            <TD><INPUT TYPE="text" NAME="T" SIZE=6 VALUE=298.15 oninput="updateTemp();">K</TD>
            <TD></TD>
            <TD></TD>
         </TR>
         <TR>
            <TD>
               upper degeneracy=<INPUT TYPE="text" NAME="gj" SIZE="2" VALUE=1 oninput="boltzman();"></TD>
            <TD><INPUT TYPE="text" NAME="fup" SIZE=7 VALUE=50.0 onFocus="blur();">%</TD>
            <TD><INPUT TYPE="text" NAME="up" SIZE=12 VALUE="-ooooo-" onFocus="blur();"></TD>
         </TR>
         <TR>
            <TD>
               lower degeneracy=<INPUT TYPE="text" NAME="gi" SIZE="2" VALUE=1 oninput="boltzman();"></TD>
            <TD><INPUT TYPE="text" NAME="flow" SIZE=7 VALUE=50.0 onFocus="blur();">%</TD>
            <TD><INPUT TYPE="text" NAME="low" SIZE=12 VALUE="-ooooo-" onFocus="blur();"></TD>
         </TR>
      </TABLE>
      <H5>Electrochemical Voltage</H5>
      Change the number of electrons transferred, z=
      <INPUT TYPE="text" NAME="z" SIZE=2 VALUE=1 oninput="boltzman();"><BR>
      Then, V=
      <INPUT TYPE="text" NAME="V" VALUE=0 onFocus="blur();">V<BR>

   </FORM>
</BODY>

</HTML>